#!/bin/bash
#
# regression testing using just a single orbit ('cause it is faster)
#
# written by D.G. Long at BYU 14 Mar 2014
# updated by D.G. Long at BYU 20 May 2014 + use meas_undump

# set environment variables that are required for meas_meta_setup
meas_home="/auto/users/long/src/linux/measures"  # localization specific
SIR_areas="$meas_home/ref/locs/"           # path to location of location files
SIR_region="$meas_home/ref/regiondef1.dat" # path to regiondef1.dat
export meas_home SIR_areas SIR_region

#####################
#
# generate product files using RSS data as input
## note: the setup and product files made from RSS and CSU data have the name!
#
########################

# create a working directory
mkdir work_RSS

# create input file listing (RSS)
ls -1 ../sample_data/f13_r09999_tb_v7.dat > work_RSS/F1.lis

# create test meta file for north polar stererographic projection (7 channels)
../src/prod/meas_meta_make/meas_meta_make work_RSS/ptest_RSS.meta 13 ../ref/s2g/ssmi_mN.s2g 60 60 1997 ../ref/arctic.def work_RSS/F1.lis

# create test meta file for EASE2N projection (1 channel)
../src/prod/meas_meta_make/meas_meta_make work_RSS/test_RSS.meta 13 ../ref/s2g/ssmi_mN.s2g 60 60 1997 ../ref/EASE2N_test1ch.def work_RSS/F1.lis

# Make setup files for polar stereographic case
# create setup file (RSS)
../src/prod/meas_meta_setup/meas_meta_setup_RSS/meas_meta_setup_RSS work_RSS/ptest_RSS.meta work_RSS 0

# Make setup files for EASE2N case
# create setup file (RSS)
../src/prod/meas_meta_setup/meas_meta_setup_RSS/meas_meta_setup_RSS work_RSS/test_RSS.meta work_RSS 0

# create intermediate dump files from polar stereographic setup files
../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F131-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F132-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F133-Arc97-060-060.setup work_RSS
../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F134-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F135-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F136-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F137-Arc97-060-060.setup work_RSS

# create bgi intermediate dump file
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F131-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F132-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F133-Arc97-060-060.setup work_RSS
../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F134-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F135-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F136-Arc97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F137-Arc97-060-060.setup work_RSS

# create BYU .SIR-format product files from dump files
../src/prod/meas_undump/meas_undump work_RSS/F131-Arc97-060-060.lis_dump.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F132-Arc97-060-060.lis_dump.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F133-Arc97-060-060.lis_dump.nc work_RSS 0 1
../src/prod/meas_undump/meas_undump work_RSS/F134-Arc97-060-060.lis_dump.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F135-Arc97-060-060.lis_dump.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F136-Arc97-060-060.lis_dump.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F137-Arc97-060-060.lis_dump.nc work_RSS 0 1

# create BYU .SIR-format bgi product files from dump files
#../src/prod/meas_undump/meas_undump work_RSS/F131-Arc97-060-060.lis_dump1.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F132-Arc97-060-060.lis_dump1.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F133-Arc97-060-060.lis_dump1.nc work_RSS 0 1
../src/prod/meas_undump/meas_undump work_RSS/F134-Arc97-060-060.lis_dump1.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F135-Arc97-060-060.lis_dump1.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F136-Arc97-060-060.lis_dump1.nc work_RSS 0 1
#../src/prod/meas_undump/meas_undump work_RSS/F137-Arc97-060-060.lis_dump1.nc work_RSS 0 1

# view selected results (manual)
../src/sirtool/sirtool work_RSS/F134-a-Arc97-060-060.sir
../src/sirtool/sirtool work_RSS/F134-a-Arc97-060-060.ave
../src/sirtool/sirtool work_RSS/F134-a-Arc97-060-060.grd
../src/sirtool/sirtool work_RSS/F134-a-Arc97-060-060.bgi

# create sample product netcdf files
# (grd images not supported yet)
../src/prod/meas_undump/meas_undump work_RSS/F131-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F132-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F133-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F134-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F135-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F136-Arc97-060-060.lis_dump.nc work_RSS 1 1
#../src/prod/meas_undump/meas_undump work_RSS/F137-Arc97-060-060.lis_dump.nc work_RSS 1 1

# create sir file from EASE2N projection setup files
../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F131-E2N97-060-060.setup work_RSS
#../src/prod/meas_meta_sir/meas_meta_sir work_RSS/F134-E2N97-060-060.setup work_RSS

# create bgi file
../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F131-E2N97-060-060.setup work_RSS
#../src/prod/meas_meta_bgi/meas_meta_bgi work_RSS/F134-E2N97-060-060.setup work_RSS

# create BYU .SIR-format product files
../src/prod/meas_undump/meas_undump work_RSS/F131-E2N97-060-060.lis_dump.nc work_RSS 0 1

# create BYU .SIR-format bgi product files
../src/prod/meas_undump/meas_undump work_RSS/F131-E2N97-060-060.lis_dump1.nc work_RSS 0 1

# view selected results (manual)
../src/sirtool/sirtool work_RSS/F131-a-E2N97-060-060.sir
../src/sirtool/sirtool work_RSS/F131-a-E2N97-060-060.ave
../src/sirtool/sirtool work_RSS/F131-a-E2N97-060-060.grd
../src/sirtool/sirtool work_RSS/F131-a-E2N97-060-060.bgi

# generate browse .gif images
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-Arc97-060-060.sir work_RSS/F131-a-Arc97-060-060.sir.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-Arc97-060-060.ave work_RSS/F131-a-Arc97-060-060.ave.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-Arc97-060-060.grd work_RSS/F131-a-Arc97-060-060.grd.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F134-a-Arc97-060-060.sir work_RSS/F134-a-Arc97-060-060.sir.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F134-a-Arc97-060-060.ave work_RSS/F134-a-Arc97-060-060.ave.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F134-a-Arc97-060-060.grd work_RSS/F134-a-Arc97-060-060.grd.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F134-a-Arc97-060-060.bgi work_RSS/F134-a-Arc97-060-060.bgi.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-E2N97-060-060.sir work_RSS/F131-a-E2N97-060-060.sir.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-E2N97-060-060.ave work_RSS/F131-a-E2N97-060-060.ave.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-E2N97-060-060.grd work_RSS/F131-a-E2N97-060-060.grd.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_RSS/F131-a-E2N97-060-060.bgi work_RSS/F131-a-E2N97-060-060.bgi.gif

# and view them
eog work_RSS/*.gif

#####################
#
# generate product files using CSU data as input
## caution, the setup and product files made from RSS and CSU data have the name!
#
########################

# create a working directory
mkdir work_CSU

# create input file listing (CSU)
ls -1 ../sample_data/CSU_SSMI_FCDR_V01R00_F13_D19970301_S1557_E1739_R09999.nc > work_CSU/F2.lis

# create test meta file    
../src/prod/meas_meta_make/meas_meta_make work_CSU/ptest_CSU.meta 13 ../ref/s2g/ssmi_mN.s2g 60 60 1997 ../ref/arctic.def work_CSU/F2.lis

# create test meta file for EASE2N (1 channel)
../src/prod/meas_meta_make/meas_meta_make work_CSU/test_CSU.meta 13 ../ref/s2g/ssmi_mN.s2g 60 60 1997 ../ref/EASE2N_test1ch.def work_CSU/F2.lis

# create setup file (CSU) polar stereographic
../src/prod/meas_meta_setup/meas_meta_setup_CSU/meas_meta_setup_CSU work_CSU/ptest_CSU.meta work_CSU 0
# create setup file (CSU) EASE2N
../src/prod/meas_meta_setup/meas_meta_setup_CSU/meas_meta_setup_CSU work_CSU/test_CSU.meta work_CSU 0

# create intermediate dump files from polar stereographic setup files
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F131-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F132-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F133-Arc97-060-060.setup work_CSU
../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F134-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F135-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F136-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F137-Arc97-060-060.setup work_CSU

# create bgi intermediate dump file
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F131-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F132-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F133-Arc97-060-060.setup work_CSU
../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F134-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F135-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F136-Arc97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F137-Arc97-060-060.setup work_CSU

# create BYU .SIR-format product files from dump files
#../src/prod/meas_undump/meas_undump work_CSU/F131-Arc97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F132-Arc97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F133-Arc97-060-060.lis_dump.nc work_CSU 0 1
../src/prod/meas_undump/meas_undump work_CSU/F134-Arc97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F135-Arc97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F136-Arc97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F137-Arc97-060-060.lis_dump.nc work_CSU 0 1

# create BYU .SIR-format bgi product files from dump files
#../src/prod/meas_undump/meas_undump work_CSU/F131-Arc97-060-060.lis_dump1.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F132-Arc97-060-060.lis_dump1.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F133-Arc97-060-060.lis_dump1.nc work_CSU 0 1
../src/prod/meas_undump/meas_undump work_CSU/F134-Arc97-060-060.lis_dump1.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F135-Arc97-060-060.lis_dump1.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F136-Arc97-060-060.lis_dump1.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F137-Arc97-060-060.lis_dump1.nc work_CSU 0 1

# view selected results (manual)
../src/sirtool/sirtool work_CSU/F134-a-Arc97-060-060.sir
../src/sirtool/sirtool work_CSU/F134-a-Arc97-060-060.ave
../src/sirtool/sirtool work_CSU/F134-a-Arc97-060-060.grd
../src/sirtool/sirtool work_CSU/F134-a-Arc97-060-060.bgi

# create netcdf files from sir or bgi polar stereographic projection files
# (grd images not supported yet)
#../src/prod/sir2netcdf work_CSU/F134-a-Arc97-060-060.sir work_CSU
#../src/prod/sir2netcdf work_CSU/F134-a-Arc97-060-060.ave work_CSU
#../src/prod/sir2netcdf work_CSU/F134-a-Arc97-060-060.bgi work_CSU

# create intermediate dump sir files from EASE2N setup files
../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F131-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F132-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F133-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F134-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F135-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F136-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_sir/meas_meta_sir work_CSU/F13y-E2N97-060-060.setup work_CSU

# create BYU .SIR-format product files from dump files
../src/prod/meas_undump/meas_undump work_CSU/F131-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F132-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F133-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F134-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F135-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F136-E2N97-060-060.lis_dump.nc work_CSU 0 1
#../src/prod/meas_undump/meas_undump work_CSU/F137-E2N97-060-060.lis_dump.nc work_CSU 0 1

# create intermediate dump bgi files from EASE2N setup files
../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F131-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F132-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F133-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F134-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F135-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F136-E2N97-060-060.setup work_CSU
#../src/prod/meas_meta_bgi/meas_meta_bgi work_CSU/F137-E2N97-060-060.setup work_CSU

# create BYU .SIR-format product files from dump files
../src/prod/meas_undump/meas_undump work_CSU/F131-E2N97-060-060.lis_dump1.nc work_CSU 0 1

# view selected results (manual)
../src/sirtool/sirtool work_CSU/F131-a-E2N97-060-060.sir
../src/sirtool/sirtool work_CSU/F131-a-E2N97-060-060.ave
../src/sirtool/sirtool work_CSU/F131-a-E2N97-060-060.grd
../src/sirtool/sirtool work_CSU/F131-a-E2N97-060-060.bgi

# create netcdf files from sir or bgi EASE2 projection files
# (not supported yet)
#../src/prod/sir2netcdf work_CSU/F131-a-E2N97-060-060.ave work_CSU

# generate browse .gif images
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F134-a-Arc97-060-060.sir work_CSU/F134-a-Arc97-060-060.sir.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F134-a-Arc97-060-060.ave work_CSU/F134-a-Arc97-060-060.ave.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F134-a-Arc97-060-060.grd work_CSU/F134-a-Arc97-060-060.grd.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F134-a-Arc97-060-060.bgi work_CSU/F134-a-Arc97-060-060.bgi.gif

../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F131-a-E2N97-060-060.sir work_CSU/F131-a-E2N97-060-060.sir.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F131-a-E2N97-060-060.ave work_CSU/F131-a-E2N97-060-060.ave.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F131-a-E2N97-060-060.grd work_CSU/F131-a-E2N97-060-060.grd.gif
../src/sir2gifs/sir2gifs -f../ref/s2g/ssmi.s2g work_CSU/F131-a-E2N97-060-060.bgi work_CSU/F131-a-E2N97-060-060.bgi.gif

# and view them
eog work_CSU/*.gif
